<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ user.name }}ã•ã‚“ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</title>

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
  </head>
  <body>
    <div class="container py-4">
      <div class="row justify-content-center">
        <div class="col-12 col-sm-10 col-md-8 col-lg-8">
          <!--   <div class="col-12 col-sm-10 col-md-8 col-lg-6">  -->
          <div class="card profile-card bg-white">
            <!-- æ˜Ÿã®ãŠæ°—ã«å…¥ã‚Šãƒœã‚¿ãƒ³ -->
            <span
    class="favorite-btn {% if liked %}active{% endif %}" 
              id="favoriteBtn"
              onclick="toggleFavorite()"
              >â˜…</span
            >

            <!-- ç”»åƒ -->
            <img
              src="{{ url_for('static', filename=user.image_path if user.image_path.startswith('uploads/') else 'img/default.png') }}"
              alt="{{ user.name }}"
              class="profile-img-circle"
            />

            <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ± -->
            <div class="card-body">
              <h4 class="card-title text-center">{{ user.name }} ã•ã‚“</h4>

              <ul class="list-group list-group-flush">
                <li class="list-group-item">
                  <strong>æ€§åˆ¥:</strong> {{ user.gender or 'æœªè¨­å®š' }}
                </li>
                <li class="list-group-item">
                  <strong>è¨€èª:</strong> {{ user.language }}
                </li>
                <li class="list-group-item">
                  <strong>é–‹ç™ºåˆ†é‡:</strong> {{ user.dev_field }}
                </li>
                <li class="list-group-item">
                  <strong>å­¦ç¿’æ­´:</strong> {{ user.experience or 'éå…¬é–‹' }}
                </li>
                <li class="list-group-item">
                  <strong>è‡ªå·±ç´¹ä»‹:</strong><br />{{ user.introduction or
                  'ã¾ã è‡ªå·±ç´¹ä»‹ãŒã‚ã‚Šã¾ã›ã‚“ã€‚' }}
                </li>
              </ul>

              <!-- â–¼ é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã‚’ã‚«ãƒ¼ãƒ‰ã®ä¸‹ä¸­å¤®ã« -->
              <div class="close-bottom">
                <button onclick="window.location.replace(document.referrer)">Ã— é–‰ã˜ã‚‹</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- JSï¼šãŠæ°—ã«å…¥ã‚Šãƒœã‚¿ãƒ³åˆ¶å¾¡ -->
    <!-- 
  <script>
    function toggleFavorite() {
      const btn = document.getElementById("favoriteBtn");
      btn.classList.toggle("active");

      // TODO: Flaskã¸é€šçŸ¥é€ä¿¡ï¼ˆAPIã‚„POSTï¼‰
		
      // fetch(`/favorite/{{ user.id }}`, { method: 'POST' })
    }
  </script>
	-->
    <!-- JSã®toggleFavorite()å†…ã§ã€ç›¸æ‰‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®IDï¼ˆuser.idï¼‰ã‚’ä½¿ã£ã¦POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚Šã¾ã™ -->
    <!--  {{ user.id }} ãŒãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§æ­£ã—ãæ¸¡ã£ã¦ã„ã‚‹ã“ã¨ãŒå‰æ -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
    <script>
      function toggleFavorite() {
        const btn = document.getElementById("favoriteBtn");
        btn.classList.toggle("active");

        // Flaskã«é€šçŸ¥ç”¨ã®POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
        fetch("/favorite/{{ user.id }}", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            target_user_id: "{{ user.id }}",
          }),
        })
          .then((response) => {
            if (!response.ok) throw new Error("ãƒªã‚¯ã‚¨ã‚¹ãƒˆå¤±æ•—");
            return response.json();
          })
          .then((data) => {
            console.log("é€šçŸ¥ãŒé€ä¿¡ã•ã‚Œã¾ã—ãŸ:", data.message);
            if (data.matched) {
              const modal = new bootstrap.Modal(document.getElementById('matchModal'));
              modal.show();
            }
          })
          .catch((error) => {
            console.error("é€šçŸ¥é€ä¿¡ã‚¨ãƒ©ãƒ¼:", error);
          });
      }
    </script>

    <!-- JSã®toggleFavorite()å†…ã§ã€ç›¸æ‰‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®IDï¼ˆuser.idï¼‰ã‚’ä½¿ã£ã¦POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚Šã¾ã™ -->
    <div class="modal fade" id="matchModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center">
      <div class="modal-body">
        <h5>ğŸ‰ ãƒãƒƒãƒã—ã¾ã—ãŸï¼</h5>
        <p>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã£ã¦ã¿ã¾ã—ã‚‡ã†ï¼</p>
        <button class="btn btn-primary" data-bs-dismiss="modal">é–‰ã˜ã‚‹</button>
      </div>
    </div>
  </div>
</div>
  </body>
</html>
